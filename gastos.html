<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo - Klohe</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 2rem 1rem;
      color: #1f2937;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 2.2rem;
      letter-spacing: -1px;
    }
    .catalogo {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .producto {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      width: 250px;
      padding: 1rem;
      box-shadow: 0 6px 20px rgba(0, 0, 0, .08);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: transform .3s, box-shadow .3s;
    }
    .producto:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, .12);
    }
    .producto img {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 12px;
      cursor: pointer;
    }
    .producto h3 {
      margin: .8rem 0 .3rem;
      font-size: 1.1rem;
      color: #3b82f6;
    }
    .producto p {
      margin: .2rem 0;
      font-size: .85rem;
      color: #6b7280;
    }
  </style>
</head>
<body>

  <h1>CATALOGO KLOHE</h1>

  <div class="catalogo" id="catalogo"></div>

  <script>
    const catalogo = document.getElementById('catalogo');

    async function renderCatalogo() {
      const lista = JSON.parse(localStorage.getItem('inventory')) || [];
      catalogo.innerHTML = '';

      for (const prod of lista) {
        const div = document.createElement('div');
        div.className = 'producto';

        // leer imagen desde localforage (misma clave que usa compra.html)
        const blob = await localforage.getItem(`img_${prod.code}`);
        const imgSrc = blob ? URL.createObjectURL(blob) : '';

        div.innerHTML = `
          <img src="${imgSrc}" alt="${prod.name}" onclick="window.open('${imgSrc}', '_blank')">
          <h3>${prod.name}</h3>
          <p><strong>Precio:</strong> $${Number(prod.price).toFixed(2)}</p>
          <p><strong>Categoría:</strong> ${prod.category}</p>
          <p><strong>Código de barras:</strong> ${prod.barcode}</p>
        `;
        catalogo.appendChild(div);
      }
    }

    // primer render
    renderCatalogo();

    // escuchar cambios externos
    window.addEventListener('storage', e => {
      if (e.key === 'inventory') renderCatalogo();
    });
  </script>

</body>
</html>
