<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Facturas – KLOHESV & CASEUP</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: "Courier New", monospace;
      background-color: #f9f9f9;
      margin: 0;
      padding: 20px;
    }
    .facturas-container {
      display: flex;
      gap: 40px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .ticket {
      width: 360px;
      background: #fff;
      padding: 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    h2 {
      text-align: center;
      margin-bottom: 5px;
      letter-spacing: 1px;
    }
    .center { text-align: center; }
    .info, .footer {
      font-size: 13px;
      margin-top: 10px;
      border-top: 1px dashed #999;
      padding-top: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 10px;
    }
    th, td {
      text-align: center;
      padding: 4px 2px;
    }
    th { border-bottom: 1px dashed #999; }
    .total {
      border-top: 1px dashed #999;
      text-align: right;
      font-weight: bold;
      margin-top: 10px;
      padding-top: 5px;
    }
    button {
      margin-top: 10px;
      width: 100%;
      background: black;
      color: white;
      border: none;
      padding: 8px;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover { background: #333; }
    .social { font-size: 12px; margin-top: 5px; text-align: center; color: #555; }
    .policy { font-size: 11px; margin-top: 8px; color: #444; text-align: center; }
    input[type="number"] { width: 50px; padding: 3px; }
  </style>
</head>
<body>
  <div class="facturas-container">
    <!-- ========== KLOHE ========== -->
    <div class="ticket" id="invoice-klohe">
      <h2>KLOHESV</h2>
      <div class="center">
        <p>San Salvador, El Salvador</p>
        <p>Correo: industriastobias@gmail.com</p>
      </div>
      <div class="social"><p>Instagram: @Klohesv</p></div>
      <div class="info">
        <p><strong>Factura N°:</strong> <span contenteditable="true">00015</span></p>
        <p><strong>Fecha:</strong> <span class="fecha-klohe"></span></p>
        <p><strong>Cliente:</strong> <span contenteditable="true">Consumidor Final</span></p>
      </div>
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cant</th>
            <th>Precio</th>
            <th>Desc(%)</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="productos-klohe">
          <tr>
            <td contenteditable="true">Collar</td>
            <td contenteditable="true" class="cantidad-klohe">1</td>
            <td contenteditable="true" class="precio-klohe">10.00</td>
            <td contenteditable="true" class="desc-klohe">0</td>
            <td class="subtotal-klohe">10.00</td>
          </tr>
        </tbody>
      </table>
      <button onclick="agregarFila('klohe')">Agregar producto</button>
      <button onclick="calcularTotal('klohe')">Actualizar total</button>
      <div class="total">TOTAL: $<span id="total-klohe">10.00</span></div>
      <div class="footer center">
        <p>¡Gracias por su compra!</p>
        <p class="policy">No se aceptan cambios ni devoluciones, a menos que el producto esté dañado. Se aceptará dentro de los 5 días posteriores a la fecha de compra.</p>
      </div>
      <button onclick="descargarPDF('klohe')">Descargar PDF</button>
      <button onclick="imprimirFactura('klohe')">Imprimir Factura</button>
    </div>

    <!-- ========== CASEUP ========== -->
    <div class="ticket" id="invoice-caseup">
      <h2>CASEUP</h2>
      <div class="center">
        <p>San Salvador, El Salvador</p>
        <p>Correo: industriastobias@gmail.com</p>
      </div>
      <div class="social"><p>Instagram: <span contenteditable="true">@caseupsv</span></p></div>
      <div class="info">
        <p><strong>Factura N°:</strong> <span contenteditable="true">00016</span></p>
        <p><strong>Fecha:</strong> <span class="fecha-caseup"></span></p>
        <p><strong>Cliente:</strong> <span contenteditable="true">Consumidor Final</span></p>
      </div>
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cant</th>
            <th>Precio</th>
            <th>Desc(%)</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="productos-caseup">
          <tr>
            <td contenteditable="true">Pulsera</td>
            <td contenteditable="true" class="cantidad-caseup">1</td>
            <td contenteditable="true" class="precio-caseup">5.00</td>
            <td contenteditable="true" class="desc-caseup">0</td>
            <td class="subtotal-caseup">5.00</td>
          </tr>
        </tbody>
      </table>
      <button onclick="agregarFila('caseup')">Agregar producto</button>
      <button onclick="calcularTotal('caseup')">Actualizar total</button>
      <div class="total">TOTAL: $<span id="total-caseup">5.00</span></div>
      <div class="footer center">
        <p>¡Gracias por su compra!</p>
        <p class="policy">No se aceptan cambios ni devoluciones, a menos que el producto esté dañado. Se aceptará dentro de los 5 días posteriores a la fecha de compra.</p>
      </div>
      <button onclick="descargarPDF('caseup')">Descargar PDF</button>
      <button onclick="imprimirFactura('caseup')">Imprimir Factura</button>
    </div>
  </div>

  <script>
    function obtenerFechaActual() {
      const f = new Date();
      return `${String(f.getDate()).padStart(2,'0')}/${String(f.getMonth()+1).padStart(2,'0')}/${f.getFullYear()}`;
    }
    document.querySelectorAll(".fecha-klohe").forEach(el => el.textContent = obtenerFechaActual());
    document.querySelectorAll(".fecha-caseup").forEach(el => el.textContent = obtenerFechaActual());

    function agregarFila(marca) {
      const suffix = marca;
      const tbody = document.getElementById(`productos-${suffix}`);
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td contenteditable="true">Nuevo producto</td>
        <td contenteditable="true" class="cantidad-${suffix}">1</td>
        <td contenteditable="true" class="precio-${suffix}">0.00</td>
        <td contenteditable="true" class="desc-${suffix}">0</td>
        <td class="subtotal-${suffix}">0.00</td>
      `;
      tbody.appendChild(fila);
    }

    function calcularTotal(marca) {
      const suffix = marca;
      let total = 0;
      document.querySelectorAll(`#productos-${suffix} tr`).forEach(tr => {
        const cant = parseFloat(tr.querySelector(`.cantidad-${suffix}`).textContent) || 0;
        const precio = parseFloat(tr.querySelector(`.precio-${suffix}`).textContent) || 0;
        const desc = parseFloat(tr.querySelector(`.desc-${suffix}`).textContent) || 0;
        const sub = cant * precio * (1 - desc / 100);
        tr.querySelector(`.subtotal-${suffix}`).textContent = sub.toFixed(2);
        total += sub;
      });
      document.getElementById(`total-${suffix}`).textContent = total.toFixed(2);
    }

    function descargarPDF(marca) {
      const id = `invoice-${marca}`;
      const ticket = document.getElementById(id);
      const botones = ticket.querySelectorAll("button");
      botones.forEach(b => b.style.display = "none");
      html2canvas(ticket).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p", "mm", [140, 200]);
        const imgWidth = 130;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        pdf.addImage(imgData, "PNG", 5, 5, imgWidth, imgHeight);
        pdf.save(`factura_${marca.toUpperCase()}.pdf`);
        botones.forEach(b => b.style.display = "block");
      });
    }

    function imprimirFactura(marca) {
      const id = `invoice-${marca}`;
      const ticket = document.getElementById(id);
      const botones = ticket.querySelectorAll("button");
      botones.forEach(b => b.style.display = "none");
      window.print();
      botones.forEach(b => b.style.display = "block");
    }

    // inits
    calcularTotal('klohe');
    calcularTotal('caseup');
  </script>
</body>
</html>
