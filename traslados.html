<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrias Tobias | Proforma Comercial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --paper: #FDFCF8;
            --warm-gray: #F5F4F0;
            --mid-gray: #E5E4E0;
            --stone: #8C8B87;
            --charcoal: #2A2A28;
            --ink: #1A1A18;
            --tobias-blue: #4A5568;
            --tobias-gold: #B8860B;
            --success: #5A6B5C;
            --error: #8B4513;
            --saved: #2E7D32;
            --border: 1px solid var(--mid-gray);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--paper);
            color: var(--charcoal);
            line-height: 1.6;
            font-size: 14px;
        }

        /* Save indicator */
        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--saved);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .save-status.show {
            opacity: 1;
        }

        /* Header Tobias */
        header {
            background: var(--ink);
            padding: 2rem 3rem;
            border-bottom: 3px solid var(--tobias-gold);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand-tobias {
            display: flex;
            flex-direction: column;
        }

        .company-name {
            font-family: 'Crimson Text', serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--paper);
            letter-spacing: 1px;
        }

        .company-tagline {
            font-size: 0.75rem;
            color: var(--stone);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-top: 0.25rem;
            font-style: italic;
        }

        .header-badge {
            text-align: right;
            color: var(--stone);
            font-size: 0.85rem;
        }

        .doc-label {
            display: inline-block;
            background: var(--tobias-gold);
            color: var(--ink);
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        /* Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                padding: 2rem;
            }
        }

        /* Panels */
        .panel {
            background: white;
            border: var(--border);
            padding: 2.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .panel-title {
            font-family: 'Crimson Text', serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--ink);
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--tobias-gold);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .panel-icon {
            width: 28px;
            height: 28px;
            background: var(--warm-gray);
            border: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--stone);
        }

        input, select, textarea {
            padding: 0.875rem 1rem;
            border: var(--border);
            background: var(--paper);
            color: var(--charcoal);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--tobias-blue);
            background: white;
        }

        input::placeholder {
            color: var(--stone);
            opacity: 0.6;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238C8B87' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .category-card {
            border: var(--border);
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            position: relative;
        }

        .category-card:hover, .category-card.active {
            border-color: var(--tobias-blue);
            background: var(--warm-gray);
        }

        .category-card.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--tobias-gold);
        }

        .category-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .category-name {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--charcoal);
        }

        /* Countries Section */
        .countries-section {
            background: var(--warm-gray);
            border: var(--border);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .countries-title {
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .countries-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .country-box {
            background: white;
            border: var(--border);
            padding: 1rem;
        }

        .country-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--stone);
            margin-bottom: 0.5rem;
        }

        .country-select {
            width: 100%;
            padding: 0.75rem;
            border: var(--border);
            background: white;
            font-size: 0.9rem;
        }

        /* Logistics Panel */
        .logistics-panel {
            background: var(--warm-gray);
            border: var(--border);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .logistics-title {
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logistics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .logistics-box {
            background: white;
            border: var(--border);
            padding: 1rem;
            text-align: center;
        }

        .logistics-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--stone);
            margin-bottom: 0.5rem;
        }

        .logistics-value {
            font-family: 'Crimson Text', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--ink);
        }

        .logistics-input {
            width: 100%;
            text-align: center;
            padding: 0.5rem;
            font-size: 1rem;
            border: var(--border);
            background: white;
        }

        /* Product Lines */
        .product-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr auto;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--warm-gray);
            border-bottom: 2px solid var(--ink);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--stone);
        }

        .product-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr auto;
            gap: 0.75rem;
            align-items: center;
            padding: 0.75rem;
            border-bottom: var(--border);
            transition: background 0.2s;
        }

        .product-row:hover {
            background: var(--warm-gray);
        }

        .product-row input {
            padding: 0.625rem;
            font-size: 0.9rem;
            width: 100%;
        }

        .btn-remove {
            width: 32px;
            height: 32px;
            border: var(--border);
            background: transparent;
            color: var(--stone);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.2s;
        }

        .btn-remove:hover {
            border-color: var(--error);
            color: var(--error);
            background: rgba(139, 69, 19, 0.05);
        }

        /* Buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-primary {
            background: var(--ink);
            color: var(--paper);
        }

        .btn-primary:hover {
            background: var(--tobias-blue);
        }

        .btn-secondary {
            background: transparent;
            color: var(--charcoal);
            border: var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--tobias-blue);
            color: var(--tobias-blue);
        }

        .btn-gold {
            background: var(--tobias-gold);
            color: var(--ink);
        }

        .btn-gold:hover {
            background: #DAA520;
        }

        .btn-add {
            width: 100%;
            margin-top: 1.5rem;
            justify-content: center;
            border: 1px dashed var(--stone);
            background: transparent;
            color: var(--stone);
        }

        .btn-add:hover {
            border-color: var(--tobias-blue);
            color: var(--tobias-blue);
            background: var(--warm-gray);
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2.5rem;
            padding-top: 2rem;
            border-top: var(--border);
        }

        /* Preview Document - Solo visual, no para PDF */
        .preview-panel {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .document-frame {
            background: white;
            border: var(--border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .document-header {
            background: var(--ink);
            color: var(--paper);
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--tobias-gold);
        }

        .doc-company {
            font-family: 'Crimson Text', serif;
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .doc-family {
            font-size: 0.8rem;
            color: var(--stone);
            font-style: italic;
            margin-top: 0.5rem;
            letter-spacing: 1px;
        }

        .doc-type {
            display: inline-block;
            background: var(--tobias-gold);
            color: var(--ink);
            padding: 0.5rem 2rem;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-top: 1.5rem;
        }

        .document-body {
            padding: 2.5rem;
        }

        .trade-lane {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--warm-gray);
            border: var(--border);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
        }

        .trade-box {
            text-align: center;
        }

        .trade-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--stone);
            margin-bottom: 0.25rem;
        }

        .trade-country {
            font-family: 'Crimson Text', serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--ink);
        }

        .trade-arrow {
            font-size: 1.5rem;
            color: var(--tobias-gold);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .info-block {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .info-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--stone);
            border-bottom: 1px solid var(--mid-gray);
            padding-bottom: 0.25rem;
        }

        .info-value {
            font-weight: 500;
            color: var(--ink);
            font-size: 0.95rem;
        }

        .doc-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            font-size: 0.9rem;
        }

        .doc-table th {
            background: var(--warm-gray);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--ink);
            color: var(--ink);
        }

        .doc-table td {
            padding: 1rem;
            border-bottom: var(--border);
        }

        .doc-table .text-right {
            text-align: right;
        }

        .doc-table .text-center {
            text-align: center;
        }

        .totals-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--ink);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }

        .total-row.bold {
            font-weight: 600;
            font-size: 1rem;
        }

        .total-row.final {
            font-family: 'Crimson Text', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--ink);
            border-top: 2px solid var(--tobias-gold);
            margin-top: 0.5rem;
            padding-top: 1rem;
        }

        .costs-breakdown {
            background: var(--warm-gray);
            border: var(--border);
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .costs-title {
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--ink);
        }

        .costs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .document-footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: var(--border);
            text-align: center;
            font-size: 0.8rem;
            color: var(--stone);
        }

        .document-stamp {
            position: absolute;
            bottom: 3rem;
            right: 3rem;
            width: 120px;
            height: 120px;
            border: 2px solid var(--tobias-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tobias-gold);
            font-family: 'Crimson Text', serif;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            transform: rotate(-15deg);
            opacity: 0.25;
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(253, 252, 248, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 2px solid var(--mid-gray);
            border-top-color: var(--tobias-gold);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .category-grid { grid-template-columns: repeat(2, 1fr); }
            .logistics-grid { grid-template-columns: 1fr; }
            .countries-grid { grid-template-columns: 1fr; }
            .product-header, .product-row {
                grid-template-columns: 2fr 1fr 1fr auto;
            }
            .product-header > :nth-child(4),
            .product-header > :nth-child(5),
            .product-header > :nth-child(6),
            .product-row > :nth-child(4),
            .product-row > :nth-child(5),
            .product-row > :nth-child(6) {
                display: none;
            }
            .trade-lane {
                flex-direction: column;
                gap: 1rem;
            }
            .trade-arrow {
                transform: rotate(90deg);
            }
        }

        /* PDF Element - Oculto pero renderizable */
        #pdfElement {
            position: absolute;
            left: -9999px;
            top: 0;
            width: 210mm;
            background: white;
            padding: 20mm;
            font-family: 'Inter', sans-serif;
            color: #1A1A18;
        }

        #pdfElement .pdf-header {
            text-align: center;
            background: #1A1A18;
            color: #FDFCF8;
            padding: 30px;
            margin: -20mm -20mm 20mm -20mm;
            border-bottom: 3px solid #B8860B;
        }

        #pdfElement .pdf-company {
            font-family: 'Crimson Text', serif;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        #pdfElement .pdf-family {
            font-size: 12px;
            color: #8C8B87;
            font-style: italic;
            margin-bottom: 15px;
        }

        #pdfElement .pdf-type {
            display: inline-block;
            background: #B8860B;
            color: #1A1A18;
            padding: 8px 30px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        #pdfElement .pdf-trade {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #F5F4F0;
            border: 1px solid #E5E4E0;
            padding: 15px;
            margin-bottom: 20px;
        }

        #pdfElement .pdf-trade-box {
            text-align: center;
            flex: 1;
        }

        #pdfElement .pdf-trade-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #8C8B87;
            margin-bottom: 5px;
        }

        #pdfElement .pdf-trade-value {
            font-family: 'Crimson Text', serif;
            font-size: 18px;
            font-weight: 700;
        }

        #pdfElement .pdf-arrow {
            font-size: 24px;
            color: #B8860B;
            margin: 0 20px;
        }

        #pdfElement .pdf-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        #pdfElement .pdf-block {
            margin-bottom: 10px;
        }

        #pdfElement .pdf-label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #8C8B87;
            border-bottom: 1px solid #E5E4E0;
            padding-bottom: 3px;
            margin-bottom: 5px;
        }

        #pdfElement .pdf-value {
            font-size: 11px;
            color: #1A1A18;
            line-height: 1.4;
        }

        #pdfElement table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 10px;
        }

        #pdfElement th {
            background: #F5F4F0;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 8px;
            letter-spacing: 1px;
            border-bottom: 2px solid #1A1A18;
        }

        #pdfElement td {
            padding: 10px;
            border-bottom: 1px solid #E5E4E0;
        }

        #pdfElement .text-right {
            text-align: right;
        }

        #pdfElement .text-center {
            text-align: center;
        }

        #pdfElement .pdf-costs {
            background: #F5F4F0;
            border: 1px solid #E5E4E0;
            padding: 15px;
            margin: 20px 0;
        }

        #pdfElement .pdf-costs-title {
            font-family: 'Crimson Text', serif;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1A1A18;
        }

        #pdfElement .pdf-costs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        #pdfElement .pdf-cost-item {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
        }

        #pdfElement .pdf-totals {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #1A1A18;
        }

        #pdfElement .pdf-total-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 11px;
        }

        #pdfElement .pdf-total-final {
            font-family: 'Crimson Text', serif;
            font-size: 16px;
            font-weight: 700;
            color: #1A1A18;
            border-top: 2px solid #B8860B;
            margin-top: 10px;
            padding-top: 10px;
        }

        #pdfElement .pdf-footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #E5E4E0;
            text-align: center;
            font-size: 9px;
            color: #8C8B87;
        }

        #pdfElement .pdf-stamp {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 100px;
            height: 100px;
            border: 2px solid #B8860B;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #B8860B;
            font-family: 'Crimson Text', serif;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transform: rotate(-15deg);
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="save-status" id="saveStatus">
        <span>ğŸ’¾</span> Guardado automÃ¡ticamente
    </div>

    <header>
        <div class="header-content">
            <div class="brand-tobias">
                <span class="company-name">INDUSTRIAS TOBIAS</span>
                <span class="company-tagline">A Family Company</span>
            </div>
            <div class="header-badge">
                <div class="doc-label">Proforma</div>
                <div id="currentDate">12 FEB 2026</div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Formulario -->
        <div class="form-section">
            <!-- PaÃ­ses Origen/Destino -->
            <div class="panel">
                <h2 class="panel-title">
                    <span class="panel-icon">ğŸŒ</span>
                    Ruta Comercial
                </h2>
                
                <div class="countries-section">
                    <div class="countries-title">ğŸ“ EspecificaciÃ³n de PaÃ­ses</div>
                    <div class="countries-grid">
                        <div class="country-box">
                            <div class="country-label">PaÃ­s de Origen (Exportador)</div>
                            <select class="country-select" id="originCountry" onchange="saveData(); updatePreview();">
                                <option value="US">ğŸ‡ºğŸ‡¸ Estados Unidos (USA)</option>
                                <option value="CN">ğŸ‡¨ğŸ‡³ China (China)</option>
                                <option value="PE">ğŸ‡µğŸ‡ª PerÃº (Peru)</option>
                                <option value="CO">ğŸ‡¨ğŸ‡´ Colombia (Colombia)</option>
                                <option value="MX">ğŸ‡²ğŸ‡½ MÃ©xico (Mexico)</option>
                                <option value="BR">ğŸ‡§ğŸ‡· Brasil (Brazil)</option>
                                <option value="AR">ğŸ‡¦ğŸ‡· Argentina (Argentina)</option>
                                <option value="CL">ğŸ‡¨ğŸ‡± Chile (Chile)</option>
                                <option value="EC">ğŸ‡ªğŸ‡¨ Ecuador (Ecuador)</option>
                                <option value="BO">ğŸ‡§ğŸ‡´ Bolivia (Bolivia)</option>
                                <option value="PY">ğŸ‡µğŸ‡¾ Paraguay (Paraguay)</option>
                                <option value="UY">ğŸ‡ºğŸ‡¾ Uruguay (Uruguay)</option>
                                <option value="PA">ğŸ‡µğŸ‡¦ PanamÃ¡ (Panama)</option>
                                <option value="CR">ğŸ‡¨ğŸ‡· Costa Rica (Costa Rica)</option>
                                <option value="GT">ğŸ‡¬ğŸ‡¹ Guatemala (Guatemala)</option>
                                <option value="SV" selected>ğŸ‡¸ğŸ‡» El Salvador (El Salvador)</option>
                                <option value="HN">ğŸ‡­ğŸ‡³ Honduras (Honduras)</option>
                                <option value="NI">ğŸ‡³ğŸ‡® Nicaragua (Nicaragua)</option>
                                <option value="IT">ğŸ‡®ğŸ‡¹ Italia (Italy)</option>
                                <option value="ES">ğŸ‡ªğŸ‡¸ EspaÃ±a (Spain)</option>
                                <option value="IN">ğŸ‡®ğŸ‡³ India (India)</option>
                                <option value="BD">ğŸ‡§ğŸ‡© Bangladesh (Bangladesh)</option>
                                <option value="VN">ğŸ‡»ğŸ‡³ Vietnam (Vietnam)</option>
                                <option value="ID">ğŸ‡®ğŸ‡© Indonesia (Indonesia)</option>
                                <option value="TR">ğŸ‡¹ğŸ‡· TurquÃ­a (Turkey)</option>
                                <option value="KR">ğŸ‡°ğŸ‡· Corea del Sur (South Korea)</option>
                                <option value="JP">ğŸ‡¯ğŸ‡µ JapÃ³n (Japan)</option>
                                <option value="TH">ğŸ‡¹ğŸ‡­ Tailandia (Thailand)</option>
                            </select>
                        </div>
                        <div class="country-box">
                            <div class="country-label">PaÃ­s de Destino (Importador)</div>
                            <select class="country-select" id="destinationCountry" onchange="saveData(); updatePreview();">
                                <option value="US">ğŸ‡ºğŸ‡¸ Estados Unidos (USA)</option>
                                <option value="CN">ğŸ‡¨ğŸ‡³ China (China)</option>
                                <option value="PE">ğŸ‡µğŸ‡ª PerÃº (Peru)</option>
                                <option value="CO">ğŸ‡¨ğŸ‡´ Colombia (Colombia)</option>
                                <option value="MX">ğŸ‡²ğŸ‡½ MÃ©xico (Mexico)</option>
                                <option value="BR">ğŸ‡§ğŸ‡· Brasil (Brazil)</option>
                                <option value="AR">ğŸ‡¦ğŸ‡· Argentina (Argentina)</option>
                                <option value="CL">ğŸ‡¨ğŸ‡± Chile (Chile)</option>
                                <option value="EC">ğŸ‡ªğŸ‡¨ Ecuador (Ecuador)</option>
                                <option value="BO">ğŸ‡§ğŸ‡´ Bolivia (Bolivia)</option>
                                <option value="PY">ğŸ‡µğŸ‡¾ Paraguay (Paraguay)</option>
                                <option value="UY">ğŸ‡ºğŸ‡¾ Uruguay (Uruguay)</option>
                                <option value="PA">ğŸ‡µğŸ‡¦ PanamÃ¡ (Panama)</option>
                                <option value="CR">ğŸ‡¨ğŸ‡· Costa Rica (Costa Rica)</option>
                                <option value="GT">ğŸ‡¬ğŸ‡¹ Guatemala (Guatemala)</option>
                                <option value="SV">ğŸ‡¸ğŸ‡» El Salvador (El Salvador)</option>
                                <option value="HN">ğŸ‡­ğŸ‡³ Honduras (Honduras)</option>
                                <option value="NI">ğŸ‡³ğŸ‡® Nicaragua (Nicaragua)</option>
                                <option value="IT">ğŸ‡®ğŸ‡¹ Italia (Italy)</option>
                                <option value="ES">ğŸ‡ªğŸ‡¸ EspaÃ±a (Spain)</option>
                                <option value="IN">ğŸ‡®ğŸ‡³ India (India)</option>
                                <option value="BD">ğŸ‡§ğŸ‡© Bangladesh (Bangladesh)</option>
                                <option value="VN">ğŸ‡»ğŸ‡³ Vietnam (Vietnam)</option>
                                <option value="ID">ğŸ‡®ğŸ‡© Indonesia (Indonesia)</option>
                                <option value="TR">ğŸ‡¹ğŸ‡· TurquÃ­a (Turkey)</option>
                                <option value="KR">ğŸ‡°ğŸ‡· Corea del Sur (South Korea)</option>
                                <option value="JP">ğŸ‡¯ğŸ‡µ JapÃ³n (Japan)</option>
                                <option value="TH">ğŸ‡¹ğŸ‡­ Tailandia (Thailand)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Puerto/Aeropuerto de Origen</label>
                        <select id="originPort" onchange="saveData(); updatePreview();">
                            <option value="JFK">JFK Airport, New York</option>
                            <option value="LAX">LAX Airport, Los Angeles</option>
                            <option value="MIA">Port of Miami, FL</option>
                            <option value="LGB">Long Beach Port, CA</option>
                            <option value="NY">Port of New York & New Jersey</option>
                            <option value="SAV">Port of Savannah, GA</option>
                            <option value="HOU">Port of Houston, TX</option>
                            <option value="CHI">Chicago O'Hare Airport</option>
                            <option value="SFO">San Francisco International</option>
                            <option value="SEA">Port of Seattle, WA</option>
                            <option value="ACAJUTLA">Port of Acajutla, El Salvador</option>
                            <option value="LAUNION">Port of La UniÃ³n, El Salvador</option>
                            <option value="SS">San Salvador Airport (SAL)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Puerto/Aeropuerto de Destino</label>
                        <select id="destinationPort" onchange="saveData(); updatePreview();">
                            <option value="CALLAO">Port of Callao, Lima</option>
                            <option value="LIMA">Jorge ChÃ¡vez Airport, Lima</option>
                            <option value="GUAYAQUIL">Port of Guayaquil, Ecuador</option>
                            <option value="VALPO">Port of ValparaÃ­so, Chile</option>
                            <option value="BUENOS">Port of Buenos Aires, Argentina</option>
                            <option value="SANTOS">Port of Santos, Brazil</option>
                            <option value="BARRANQUILLA">Port of Barranquilla, Colombia</option>
                            <option value="CARTAGENA">Port of Cartagena, Colombia</option>
                            <option value="ACAJUTLA">Port of Acajutla, El Salvador</option>
                            <option value="LAUNION">Port of La UniÃ³n, El Salvador</option>
                            <option value="SS">San Salvador Airport (SAL)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Datos del Cliente -->
            <div class="panel" style="margin-top: 2rem;">
                <h2 class="panel-title">
                    <span class="panel-icon">ğŸ‘¤</span>
                    Datos del Importador
                </h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>RazÃ³n Social / Company Name</label>
                        <input type="text" id="clientName" placeholder="Ej: Distribuidora Norteamericana S.A." oninput="saveData(); updatePreview();">
                    </div>
                    <div class="form-group">
                        <label>Tax ID / EIN / RUC / NIT</label>
                        <input type="text" id="taxId" placeholder="12-3456789 / 0614-010190-001-0" oninput="saveData(); updatePreview();">
                    </div>
                    <div class="form-group">
                        <label>Contacto / Buyer</label>
                        <input type="text" id="contactName" placeholder="Nombre del representante" oninput="saveData(); updatePreview();">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="compras@empresa.com" oninput="saveData(); updatePreview();">
                    </div>
                    <div class="form-group">
                        <label>TelÃ©fono / WhatsApp</label>
                        <input type="tel" id="phone" placeholder="+503 7777-8888" oninput="saveData(); updatePreview();">
                    </div>
                    <div class="form-group full-width">
                        <label>DirecciÃ³n de Entrega / Delivery Address</label>
                        <textarea id="address" rows="2" placeholder="DirecciÃ³n completa de entrega final" oninput="saveData(); updatePreview();"></textarea>
                    </div>
                </div>
            </div>

            <!-- CategorÃ­a -->
            <div class="panel" style="margin-top: 2rem;">
                <h2 class="panel-title">
                    <span class="panel-icon">ğŸ·ï¸</span>
                    CategorÃ­a de Producto
                </h2>
                <div class="category-grid">
                    <div class="category-card" onclick="selectCategory('textile')" data-cat="textile">
                        <span class="category-icon">ğŸ§µ</span>
                        <div class="category-name">Textil</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('footwear')" data-cat="footwear">
                        <span class="category-icon">ğŸ‘</span>
                        <div class="category-name">Calzado</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('accessories')" data-cat="accessories">
                        <span class="category-icon">ğŸ‘œ</span>
                        <div class="category-name">Accesorios</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('cosmetics')" data-cat="cosmetics">
                        <span class="category-icon">ğŸ’„</span>
                        <div class="category-name">Maquillaje</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('home')" data-cat="home">
                        <span class="category-icon">ğŸ </span>
                        <div class="category-name">Hogar</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('industrial')" data-cat="industrial">
                        <span class="category-icon">âš™ï¸</span>
                        <div class="category-name">Industrial</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('raw')" data-cat="raw">
                        <span class="category-icon">ğŸ§¶</span>
                        <div class="category-name">Materia Prima</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('other')" data-cat="other">
                        <span class="category-icon">ğŸ“¦</span>
                        <div class="category-name">Otros</div>
                    </div>
                </div>
            </div>

            <!-- LogÃ­stica y Costos -->
            <div class="panel" style="margin-top: 2rem;">
                <h2 class="panel-title">
                    <span class="panel-icon">ğŸš¢</span>
                    Costos de ImportaciÃ³n
                </h2>
                
                <div class="logistics-panel">
                    <div class="logistics-title">ğŸ“¦ InformaciÃ³n de Carga</div>
                    <div class="logistics-grid">
                        <div class="logistics-box">
                            <div class="logistics-label">Peso Total (kg)</div>
                            <input type="number" class="logistics-input" id="totalWeight" placeholder="0.00" step="0.01" oninput="saveData(); updateCalculations();">
                        </div>
                        <div class="logistics-box">
                            <div class="logistics-label">Volumen (CBM)</div>
                            <input type="number" class="logistics-input" id="totalVolume" placeholder="0.00" step="0.01" oninput="saveData(); updateCalculations();">
                        </div>
                        <div class="logistics-box">
                            <div class="logistics-label">Tipo de Carga</div>
                            <select class="logistics-input" id="cargoType" onchange="saveData(); updatePreview();">
                                <option value="FCL">FCL (Contenedor)</option>
                                <option value="LCL">LCL (Consolidado)</option>
                                <option value="AIR">AÃ©reo</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="logistics-panel" style="margin-top: 1rem;">
                    <div class="logistics-title">ğŸ’° Costos Internacionales</div>
                    <div class="logistics-grid">
                        <div class="logistics-box">
                            <div class="logistics-label">Flete / Freight ($)</div>
                            <input type="number" class="logistics-input" id="shippingCost" placeholder="0.00" step="0.01" oninput="saveData(); updateCalculations();">
                        </div>
                        <div class="logistics-box">
                            <div class="logistics-label">Seguro / Insurance (%)</div>
                            <input type="number" class="logistics-input" id="insuranceRate" placeholder="2" value="2" step="0.1" oninput="saveData(); updateCalculations();">
                        </div>
                        <div class="logistics-box">
                            <div class="logistics-label">Handling / THC ($)</div>
                            <input type="number" class="logistics-input" id="handlingCost" placeholder="0.00" step="0.01" oninput="saveData(); updateCalculations();">
                        </div>
                    </div>
                </div>

                <div class="logistics-panel" style="margin-top: 1rem;">
                    <div class="logistics-title">ğŸ“‹ Impuestos y Aranceles</div>
                    <div class="logistics-grid">
                        <div class="logistics-box">
                            <div class="logistics-label">Derecho Aduanal (%)</div>
                            <input type="number" class="logistics-input" id="customsDuty" placeholder="0" step="0.1" oninput="saveData(); updateCalculations();">
                        </div>
                        <div class="logistics-box">
                            <div class="logistics-label">IVA / VAT / GST (%)</div>
                            <input type="number" class="logistics-input" id="taxRate" placeholder="13" value="13" step="0.1" oninput="saveData(); updateCalculations();">
                        </div>
                        <div class="logistics-box">
                            <div class="logistics-label">Agente Aduanal ($)</div>
                            <input type="number" class="logistics-input" id="brokerFee" placeholder="0.00" step="0.01" oninput="saveData(); updateCalculations();">
                        </div>
                    </div>
                </div>

                <div class="form-grid" style="margin-top: 1.5rem;">
                    <div class="form-group">
                        <label>Incoterm</label>
                        <select id="incoterm" onchange="saveData(); updatePreview();">
                            <option value="FOB">FOB (Free On Board)</option>
                            <option value="CIF">CIF (Cost, Insurance, Freight)</option>
                            <option value="CFR">CFR (Cost and Freight)</option>
                            <option value="EXW">EXW (Ex Works)</option>
                            <option value="DDP">DDP (Delivered Duty Paid)</option>
                            <option value="DAP">DAP (Delivered At Place)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Moneda / Currency</label>
                        <select id="currency" onchange="saveData(); updateCalculations();">
                            <option value="USD">USD - US Dollar</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="PEN">PEN - Peruvian Sol</option>
                            <option value="CNY">CNY - Chinese Yuan</option>
                            <option value="MXN">MXN - Mexican Peso</option>
                            <option value="COP">COP - Colombian Peso</option>
                            <option value="GTQ">GTQ - Guatemalan Quetzal</option>
                            <option value="HNL">HNL - Honduran Lempira</option>
                            <option value="NIO">NIO - Nicaraguan CÃ³rdoba</option>
                            <option value="CRC">CRC - Costa Rican ColÃ³n</option>
                            <option value="PAB">PAB - Panamanian Balboa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Condiciones de Pago</label>
                        <select id="paymentTerms" onchange="saveData(); updatePreview();">
                            <option value="TT">T/T (Wire Transfer)</option>
                            <option value="LC">L/C (Letter of Credit)</option>
                            <option value="DA">D/A (Documents against Acceptance)</option>
                            <option value="DP">D/P (Documents against Payment)</option>
                            <option value="CAD">CAD (Cash Against Documents)</option>
                            <option value="OA">O/A (Open Account)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tiempo de Entrega</label>
                        <input type="text" id="leadTime" placeholder="Ej: 30-45 dÃ­as" oninput="saveData(); updatePreview();">
                    </div>
                </div>
            </div>

            <!-- LÃ­neas de Producto -->
            <div class="panel" style="margin-top: 2rem;">
                <h2 class="panel-title">
                    <span class="panel-icon">ğŸ“‹</span>
                    LÃ­neas de Producto
                </h2>
                
                <div class="product-header">
                    <div>SKU / DescripciÃ³n</div>
                    <div>Qty</div>
                    <div>Unit ($)</div>
                    <div>Peso (kg)</div>
                    <div>Origen</div>
                    <div>Subtotal</div>
                    <div></div>
                </div>
                <div id="productsContainer"></div>
                
                <button class="btn btn-add" onclick="addProduct();">
                    + Agregar LÃ­nea
                </button>
            </div>

            <div class="actions">
                <button class="btn btn-primary" onclick="calculateTotal();">
                    Calcular Proforma
                </button>
                <button class="btn btn-secondary" onclick="resetForm();">
                    Limpiar Todo
                </button>
            </div>
        </div>

        <!-- Vista Previa -->
        <div class="preview-panel">
            <div class="document-frame" id="documentFrame">
                <div class="document-header">
                    <div class="doc-company">INDUSTRIAS TOBIAS</div>
                    <div class="doc-family">A Family Company</div>
                    <div class="doc-type">Proforma Invoice</div>
                </div>

                <div class="document-body" id="documentBody">
                    <!-- Trade Lane -->
                    <div class="trade-lane">
                        <div class="trade-box">
                            <div class="trade-label">PaÃ­s de Origen</div>
                            <div class="trade-country" id="previewOriginCountry">ğŸ‡¸ğŸ‡» EL SALVADOR</div>
                        </div>
                        <div class="trade-arrow">â†’</div>
                        <div class="trade-box">
                            <div class="trade-label">PaÃ­s de Destino</div>
                            <div class="trade-country" id="previewDestCountry">ğŸ‡ºğŸ‡¸ USA</div>
                        </div>
                    </div>

                    <div class="info-grid">
                        <div class="info-block">
                            <span class="info-label">Exportador / Shipper</span>
                            <span class="info-value" style="font-weight: 600;">INDUSTRIAS TOBIAS S.A.</span>
                            <span class="info-value" style="font-size: 0.85rem; color: var(--stone); margin-top: 0.25rem;">
                                350 Fifth Avenue, Suite 2500<br>
                                New York, NY 10118, USA<br>
                                industriastobias@gmail.com<br>
                                +1 (212) 555-0147
                            </span>
                        </div>
                        <div class="info-block">
                            <span class="info-label">NÂ° Proforma / Reference</span>
                            <span class="info-value" id="previewNumber">IT-2026-001</span>
                            <span class="info-label" style="margin-top: 0.75rem;">Fecha / Date</span>
                            <span class="info-value" id="previewDate">12 FEB 2026</span>
                        </div>
                        <div class="info-block">
                            <span class="info-label">Importador / Consignee</span>
                            <span class="info-value" id="previewClient">-</span>
                            <span class="info-value" id="previewTaxId" style="font-size: 0.85rem; color: var(--stone);">-</span>
                        </div>
                        <div class="info-block">
                            <span class="info-label">Ruta / Route</span>
                            <span class="info-value" id="previewRoute">JFK â†’ ACAJUTLA</span>
                            <span class="info-label" style="margin-top: 0.75rem;">Incoterm</span>
                            <span class="info-value" id="previewIncoterm">FOB</span>
                        </div>
                        <div class="info-block">
                            <span class="info-label">CategorÃ­a / Category</span>
                            <span class="info-value" id="previewCategory">-</span>
                        </div>
                        <div class="info-block">
                            <span class="info-label">Pago / Payment Terms</span>
                            <span class="info-value" id="previewPayment">T/T</span>
                        </div>
                    </div>

                    <table class="doc-table">
                        <thead>
                            <tr>
                                <th>Item / Description</th>
                                <th class="text-center">Qty</th>
                                <th class="text-right">Unit Price</th>
                                <th class="text-right">Weight</th>
                                <th class="text-right">Amount</th>
                            </tr>
                        </thead>
                        <tbody id="previewItems">
                            <tr>
                                <td colspan="5" style="text-align: center; color: var(--stone); padding: 3rem;">
                                    Ingrese productos para generar la proforma
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="costs-breakdown">
                        <div class="costs-title">Desglose de Costos LogÃ­sticos / Logistics Breakdown</div>
                        <div class="costs-grid">
                            <div class="cost-item">
                                <span>Peso Total / Total Weight:</span>
                                <span id="previewTotalWeight">0.00 kg</span>
                            </div>
                            <div class="cost-item">
                                <span>Volumen / Volume:</span>
                                <span id="previewVolume">0.00 CBM</span>
                            </div>
                            <div class="cost-item">
                                <span>Tipo de Carga / Cargo Type:</span>
                                <span id="previewCargoType">FCL</span>
                            </div>
                            <div class="cost-item">
                                <span>Freight / Flete:</span>
                                <span id="previewShipping">$0.00</span>
                            </div>
                            <div class="cost-item">
                                <span>Insurance / Seguro (<span id="previewInsRate">2</span>%):</span>
                                <span id="previewInsurance">$0.00</span>
                            </div>
                            <div class="cost-item">
                                <span>Handling / THC:</span>
                                <span id="previewHandling">$0.00</span>
                            </div>
                            <div class="cost-item">
                                <span>Customs Duty / Derecho (<span id="previewDutyRate">0</span>%):</span>
                                <span id="previewDuty">$0.00</span>
                            </div>
                            <div class="cost-item">
                                <span>Broker / Agente:</span>
                                <span id="previewBroker">$0.00</span>
                            </div>
                            <div class="cost-item">
                                <span>Tax / IVA (<span id="previewTaxRate">13</span>%):</span>
                                <span id="previewTax">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="totals-section">
                        <div class="total-row">
                            <span>Valor FOB Total:</span>
                            <span id="previewFob">$0.00</span>
                        </div>
                        <div class="total-row">
                            <span>Costo de EnvÃ­o (CIF/Freight):</span>
                            <span id="previewCif">$0.00</span>
                        </div>
                        <div class="total-row">
                            <span>Base Imponible / Taxable Base:</span>
                            <span id="previewBase">$0.00</span>
                        </div>
                        <div class="total-row bold">
                            <span>Total Impuestos & Derechos:</span>
                            <span id="previewTaxes">$0.00</span>
                        </div>
                        <div class="total-row final">
                            <span>TOTAL LANDED COST:</span>
                            <span id="previewTotal">$0.00</span>
                        </div>
                    </div>

                    <div style="margin-top: 1.5rem; font-size: 0.85rem; color: var(--stone);">
                        <strong>Tiempo de Entrega / Lead Time:</strong> <span id="previewLeadTime">Por confirmar</span>
                    </div>

                    <div class="document-footer">
                        <p style="font-style: italic; margin-bottom: 1rem;">
                            "All prices are subject to currency fluctuation. Validity: 30 calendar days.<br>
                            Los precios estÃ¡n sujetos a fluctuaciÃ³n de tipo de cambio. Validez: 30 dÃ­as calendario."
                        </p>
                        <p>
                            <strong>Industrias Tobias S.A.</strong> | Registered in New York, USA<br>
                            350 Fifth Avenue, Suite 2500, New York, NY 10118<br>
                            industriastobias@gmail.com | +1 (212) 555-0147
                        </p>
                    </div>

                    <div class="document-stamp" id="docStamp">PENDIENTE</div>
                </div>
            </div>

            <div style="margin-top: 1.5rem; text-align: center;">
                <button class="btn btn-gold" onclick="downloadPDF()" style="width: 100%; justify-content: center;">
                    ğŸ“„ Descargar Proforma PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Elemento PDF dedicado - Oculto pero renderizable -->
    <div id="pdfElement">
        <!-- Se llena dinÃ¡micamente por JavaScript -->
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: var(--stone);">Generando documento...</p>
    </div>

    <script>
        let selectedCategory = null;
        let productCount = 0;
        let currencySymbol = '$';
        let saveTimeout = null;

        const countryFlags = {
            'US': 'ğŸ‡ºğŸ‡¸', 'CN': 'ğŸ‡¨ğŸ‡³', 'PE': 'ğŸ‡µğŸ‡ª', 'CO': 'ğŸ‡¨ğŸ‡´', 'MX': 'ğŸ‡²ğŸ‡½',
            'BR': 'ğŸ‡§ğŸ‡·', 'AR': 'ğŸ‡¦ğŸ‡·', 'CL': 'ğŸ‡¨ğŸ‡±', 'EC': 'ğŸ‡ªğŸ‡¨', 'BO': 'ğŸ‡§ğŸ‡´',
            'PY': 'ğŸ‡µğŸ‡¾', 'UY': 'ğŸ‡ºğŸ‡¾', 'PA': 'ğŸ‡µğŸ‡¦', 'CR': 'ğŸ‡¨ğŸ‡·', 'GT': 'ğŸ‡¬ğŸ‡¹',
            'SV': 'ğŸ‡¸ğŸ‡»', 'HN': 'ğŸ‡­ğŸ‡³', 'NI': 'ğŸ‡³ğŸ‡®', 'IT': 'ğŸ‡®ğŸ‡¹', 'ES': 'ğŸ‡ªğŸ‡¸',
            'IN': 'ğŸ‡®ğŸ‡³', 'BD': 'ğŸ‡§ğŸ‡©', 'VN': 'ğŸ‡»ğŸ‡³', 'ID': 'ğŸ‡®ğŸ‡©', 'TR': 'ğŸ‡¹ğŸ‡·',
            'KR': 'ğŸ‡°ğŸ‡·', 'JP': 'ğŸ‡¯ğŸ‡µ', 'TH': 'ğŸ‡¹ğŸ‡­'
        };

        const countryNames = {
            'US': 'USA', 'CN': 'CHINA', 'PE': 'PERU', 'CO': 'COLOMBIA', 'MX': 'MEXICO',
            'BR': 'BRAZIL', 'AR': 'ARGENTINA', 'CL': 'CHILE', 'EC': 'ECUADOR', 'BO': 'BOLIVIA',
            'PY': 'PARAGUAY', 'UY': 'URUGUAY', 'PA': 'PANAMA', 'CR': 'COSTA RICA', 'GT': 'GUATEMALA',
            'SV': 'EL SALVADOR', 'HN': 'HONDURAS', 'NI': 'NICARAGUA', 'IT': 'ITALY', 'ES': 'SPAIN',
            'IN': 'INDIA', 'BD': 'BANGLADESH', 'VN': 'VIETNAM', 'ID': 'INDONESIA', 'TR': 'TURKEY',
            'KR': 'SOUTH KOREA', 'JP': 'JAPAN', 'TH': 'THAILAND'
        };

        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            const dateStr = today.toLocaleDateString('es-ES', { day: '2-digit', month: 'short', year: 'numeric' }).toUpperCase();
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('previewDate').textContent = dateStr;
            
            const random = String(Math.floor(Math.random() * 900) + 100).padStart(3, '0');
            document.getElementById('previewNumber').textContent = `IT-2026-${random}`;
            
            loadSavedData();
        });

        function saveData() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                const data = {
                    originCountry: document.getElementById('originCountry').value,
                    destinationCountry: document.getElementById('destinationCountry').value,
                    originPort: document.getElementById('originPort').value,
                    destinationPort: document.getElementById('destinationPort').value,
                    clientName: document.getElementById('clientName').value,
                    taxId: document.getElementById('taxId').value,
                    contactName: document.getElementById('contactName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    category: selectedCategory,
                    totalWeight: document.getElementById('totalWeight').value,
                    totalVolume: document.getElementById('totalVolume').value,
                    cargoType: document.getElementById('cargoType').value,
                    shippingCost: document.getElementById('shippingCost').value,
                    insuranceRate: document.getElementById('insuranceRate').value,
                    handlingCost: document.getElementById('handlingCost').value,
                    customsDuty: document.getElementById('customsDuty').value,
                    taxRate: document.getElementById('taxRate').value,
                    brokerFee: document.getElementById('brokerFee').value,
                    incoterm: document.getElementById('incoterm').value,
                    currency: document.getElementById('currency').value,
                    paymentTerms: document.getElementById('paymentTerms').value,
                    leadTime: document.getElementById('leadTime').value,
                    products: getProductsData(),
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('tobiasProformaData', JSON.stringify(data));
                showSaveStatus();
            }, 500);
        }

        function getProductsData() {
            const products = [];
            document.querySelectorAll('.product-row').forEach(row => {
                const id = row.id.split('-')[1];
                products.push({
                    sku: document.getElementById(`sku-${id}`).value,
                    qty: document.getElementById(`qty-${id}`).value,
                    price: document.getElementById(`price-${id}`).value,
                    weight: document.getElementById(`weight-${id}`).value,
                    origin: document.getElementById(`origin-${id}`).value
                });
            });
            return products;
        }

        function loadSavedData() {
            const saved = localStorage.getItem('tobiasProformaData');
            if (!saved) {
                addProduct();
                return;
            }

            try {
                const data = JSON.parse(saved);
                
                if (data.originCountry) document.getElementById('originCountry').value = data.originCountry;
                if (data.destinationCountry) document.getElementById('destinationCountry').value = data.destinationCountry;
                if (data.originPort) document.getElementById('originPort').value = data.originPort;
                if (data.destinationPort) document.getElementById('destinationPort').value = data.destinationPort;
                if (data.clientName) document.getElementById('clientName').value = data.clientName;
                if (data.taxId) document.getElementById('taxId').value = data.taxId;
                if (data.contactName) document.getElementById('contactName').value = data.contactName;
                if (data.email) document.getElementById('email').value = data.email;
                if (data.phone) document.getElementById('phone').value = data.phone;
                if (data.address) document.getElementById('address').value = data.address;
                if (data.category) selectCategory(data.category);
                if (data.totalWeight) document.getElementById('totalWeight').value = data.totalWeight;
                if (data.totalVolume) document.getElementById('totalVolume').value = data.totalVolume;
                if (data.cargoType) document.getElementById('cargoType').value = data.cargoType;
                if (data.shippingCost) document.getElementById('shippingCost').value = data.shippingCost;
                if (data.insuranceRate) document.getElementById('insuranceRate').value = data.insuranceRate;
                if (data.handlingCost) document.getElementById('handlingCost').value = data.handlingCost;
                if (data.customsDuty) document.getElementById('customsDuty').value = data.customsDuty;
                if (data.taxRate) document.getElementById('taxRate').value = data.taxRate;
                if (data.brokerFee) document.getElementById('brokerFee').value = data.brokerFee;
                if (data.incoterm) document.getElementById('incoterm').value = data.incoterm;
                if (data.currency) document.getElementById('currency').value = data.currency;
                if (data.paymentTerms) document.getElementById('paymentTerms').value = data.paymentTerms;
                if (data.leadTime) document.getElementById('leadTime').value = data.leadTime;
                
                if (data.products && data.products.length > 0) {
                    data.products.forEach((prod, idx) => {
                        if (idx > 0) addProduct();
                        const lastId = productCount;
                        document.getElementById(`sku-${lastId}`).value = prod.sku || '';
                        document.getElementById(`qty-${lastId}`).value = prod.qty || 1;
                        document.getElementById(`price-${lastId}`).value = prod.price || '';
                        document.getElementById(`weight-${lastId}`).value = prod.weight || '';
                        document.getElementById(`origin-${lastId}`).value = prod.origin || 'USA';
                    });
                } else {
                    addProduct();
                }
                
                updatePreview();
                updateCalculations();
                
            } catch (e) {
                console.error('Error loading saved data:', e);
                addProduct();
            }
        }

        function showSaveStatus() {
            const status = document.getElementById('saveStatus');
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 2000);
        }

        function selectCategory(cat) {
            selectedCategory = cat;
            document.querySelectorAll('.category-card').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-cat="${cat}"]`).classList.add('active');
            
            const names = {
                'textile': 'Textil y Confecciones',
                'footwear': 'Calzado y MarroquinerÃ­a',
                'accessories': 'Accesorios de Moda',
                'cosmetics': 'CosmÃ©ticos y Maquillaje',
                'home': 'ArtÃ­culos para el Hogar',
                'industrial': 'Suministros Industriales',
                'raw': 'Materias Primas',
                'other': 'Otros Productos'
            };
            
            document.getElementById('previewCategory').textContent = names[cat] || cat;
            saveData();
        }

        function addProduct() {
            productCount++;
            const container = document.getElementById('productsContainer');
            
            const row = document.createElement('div');
            row.className = 'product-row';
            row.id = `prod-${productCount}`;
            
            row.innerHTML = `
                <input type="text" placeholder="SKU / DescripciÃ³n completa" id="sku-${productCount}" oninput="saveData(); updateCalculations();">
                <input type="number" placeholder="Qty" min="1" value="1" id="qty-${productCount}" oninput="saveData(); updateCalculations();">
                <input type="number" placeholder="0.00" step="0.01" id="price-${productCount}" oninput="saveData(); updateCalculations();">
                <input type="number" placeholder="0.00" step="0.01" id="weight-${productCount}" oninput="saveData(); updateCalculations();">
                <input type="text" placeholder="Origen" id="origin-${productCount}" value="USA" oninput="saveData(); updateCalculations();">
                <input type="text" placeholder="0.00" id="subtotal-${productCount}" readonly style="background: var(--warm-gray);">
                <button class="btn-remove" onclick="removeProduct(${productCount});">Ã—</button>
            `;
            
            container.appendChild(row);
        }

        function removeProduct(id) {
            const row = document.getElementById(`prod-${id}`);
            if (document.querySelectorAll('.product-row').length > 1) {
                row.remove();
                saveData();
                updateCalculations();
            } else {
                document.getElementById(`sku-${id}`).value = '';
                document.getElementById(`qty-${id}`).value = 1;
                document.getElementById(`price-${id}`).value = '';
                document.getElementById(`weight-${id}`).value = '';
                saveData();
                updateCalculations();
            }
        }

        function updatePreview() {
            const originCode = document.getElementById('originCountry').value;
            const destCode = document.getElementById('destinationCountry').value;
            
            document.getElementById('previewOriginCountry').textContent = `${countryFlags[originCode]} ${countryNames[originCode]}`;
            document.getElementById('previewDestCountry').textContent = `${countryFlags[destCode]} ${countryNames[destCode]}`;
            
            const originPort = document.getElementById('originPort');
            const destPort = document.getElementById('destinationPort');
            document.getElementById('previewRoute').textContent = 
                `${originPort.options[originPort.selectedIndex].text.split(',')[0]} â†’ ${destPort.options[destPort.selectedIndex].text.split(',')[0]}`;
            
            document.getElementById('previewClient').textContent = document.getElementById('clientName').value || '-';
            document.getElementById('previewTaxId').textContent = document.getElementById('taxId').value || '-';
            
            document.getElementById('previewIncoterm').textContent = document.getElementById('incoterm').value || 'FOB';
            
            const payments = {
                'TT': 'T/T (Wire Transfer)',
                'LC': 'L/C (Letter of Credit)',
                'DA': 'D/A (Docs vs Acceptance)',
                'DP': 'D/P (Docs vs Payment)',
                'CAD': 'CAD (Cash Against Docs)',
                'OA': 'O/A (Open Account)'
            };
            document.getElementById('previewPayment').textContent = 
                payments[document.getElementById('paymentTerms').value] || 'T/T';
            
            document.getElementById('previewLeadTime').textContent = 
                document.getElementById('leadTime').value || 'Por confirmar / To be confirmed';
            
            const cargoTypes = { 'FCL': 'FCL (Full Container)', 'LCL': 'LCL (Consolidated)', 'AIR': 'Air Freight' };
            document.getElementById('previewCargoType').textContent = 
                cargoTypes[document.getElementById('cargoType').value] || 'FCL';
            
            const curr = document.getElementById('currency').value;
            currencySymbol = curr === 'USD' ? '$' : curr === 'EUR' ? 'â‚¬' : curr === 'PEN' ? 'S/' : 
                            curr === 'CNY' ? 'Â¥' : curr === 'MXN' ? '$' : curr === 'COP' ? '$' : 
                            curr === 'GTQ' ? 'Q' : curr === 'HNL' ? 'L' : curr === 'NIO' ? 'C$' :
                            curr === 'CRC' ? 'â‚¡' : curr === 'PAB' ? 'B/' : '$';
        }

        function updateCalculations() {
            let fobTotal = 0;
            let totalWeight = 0;
            const tbody = document.getElementById('previewItems');
            tbody.innerHTML = '';
            
            document.querySelectorAll('.product-row').forEach(row => {
                const id = row.id.split('-')[1];
                const sku = document.getElementById(`sku-${id}`).value || 'Item sin descripciÃ³n';
                const qty = parseInt(document.getElementById(`qty-${id}`).value) || 0;
                const price = parseFloat(document.getElementById(`price-${id}`).value) || 0;
                const weight = parseFloat(document.getElementById(`weight-${id}`).value) || 0;
                const lineTotal = qty * price;
                const lineWeight = qty * weight;
                
                if (qty > 0 && price > 0) {
                    fobTotal += lineTotal;
                    totalWeight += lineWeight;
                    
                    document.getElementById(`subtotal-${id}`).value = lineTotal.toFixed(2);
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${sku}</td>
                        <td class="text-center">${qty}</td>
                        <td class="text-right">${currencySymbol}${price.toFixed(2)}</td>
                        <td class="text-right">${lineWeight.toFixed(2)} kg</td>
                        <td class="text-right">${currencySymbol}${lineTotal.toFixed(2)}</td>
                    `;
                    tbody.appendChild(tr);
                }
            });
            
            if (tbody.children.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--stone); padding: 3rem;">
                            Ingrese productos para generar la proforma
                        </td>
                    </tr>
                `;
            }
            
            const volume = parseFloat(document.getElementById('totalVolume').value) || 0;
            const shipping = parseFloat(document.getElementById('shippingCost').value) || 0;
            const insuranceRate = parseFloat(document.getElementById('insuranceRate').value) || 0;
            const handling = parseFloat(document.getElementById('handlingCost').value) || 0;
            const customsRate = parseFloat(document.getElementById('customsDuty').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const broker = parseFloat(document.getElementById('brokerFee').value) || 0;
            
            const insurance = fobTotal * (insuranceRate / 100);
            const cifValue = fobTotal + shipping + insurance;
            const customsDuty = cifValue * (customsRate / 100);
            const taxableBase = cifValue + customsDuty;
            const tax = taxableBase * (taxRate / 100);
            const totalLanded = taxableBase + tax + handling + broker;
            
            document.getElementById('previewTotalWeight').textContent = `${totalWeight.toFixed(2)} kg`;
            document.getElementById('previewVolume').textContent = `${volume.toFixed(2)} CBM`;
            document.getElementById('previewShipping').textContent = `${currencySymbol}${shipping.toFixed(2)}`;
            document.getElementById('previewInsRate').textContent = insuranceRate;
            document.getElementById('previewInsurance').textContent = `${currencySymbol}${insurance.toFixed(2)}`;
            document.getElementById('previewHandling').textContent = `${currencySymbol}${handling.toFixed(2)}`;
            document.getElementById('previewDutyRate').textContent = customsRate;
            document.getElementById('previewDuty').textContent = `${currencySymbol}${customsDuty.toFixed(2)}`;
            document.getElementById('previewBroker').textContent = `${currencySymbol}${broker.toFixed(2)}`;
            document.getElementById('previewTaxRate').textContent = taxRate;
            document.getElementById('previewTax').textContent = `${currencySymbol}${tax.toFixed(2)}`;
            
            document.getElementById('previewFob').textContent = `${currencySymbol}${fobTotal.toFixed(2)}`;
            document.getElementById('previewCif').textContent = `${currencySymbol}${(shipping + insurance).toFixed(2)}`;
            document.getElementById('previewBase').textContent = `${currencySymbol}${taxableBase.toFixed(2)}`;
            document.getElementById('previewTaxes').textContent = `${currencySymbol}${(customsDuty + tax).toFixed(2)}`;
            document.getElementById('previewTotal').textContent = `${currencySymbol}${totalLanded.toFixed(2)}`;
            
            const stamp = document.getElementById('docStamp');
            if (fobTotal > 0) {
                stamp.textContent = 'VALIDADO';
                stamp.style.borderColor = 'var(--success)';
                stamp.style.color = 'var(--success)';
                stamp.style.opacity = '0.3';
            } else {
                stamp.textContent = 'PENDIENTE';
                stamp.style.borderColor = 'var(--tobias-gold)';
                stamp.style.color = 'var(--tobias-gold)';
                stamp.style.opacity = '0.25';
            }
        }

        function calculateTotal() {
            updateCalculations();
            const btn = document.querySelector('.btn-primary');
            const original = btn.innerHTML;
            btn.innerHTML = 'âœ“ Calculado';
            setTimeout(() => btn.innerHTML = original, 2000);
        }

        function generatePDFContent() {
            const originCode = document.getElementById('originCountry').value;
            const destCode = document.getElementById('destinationCountry').value;
            const originPort = document.getElementById('originPort');
            const destPort = document.getElementById('destinationPort');
            const clientName = document.getElementById('clientName').value || '-';
            const taxId = document.getElementById('taxId').value || '-';
            const proformaNum = document.getElementById('previewNumber').textContent;
            const dateStr = document.getElementById('previewDate').textContent;
            const category = document.getElementById('previewCategory').textContent || '-';
            const incoterm = document.getElementById('incoterm').value || 'FOB';
            const payment = document.getElementById('previewPayment').textContent;
            const leadTime = document.getElementById('leadTime').value || 'Por confirmar / To be confirmed';
            const cargoType = document.getElementById('cargoType').value || 'FCL';
            
            // Calcular totales
            let fobTotal = 0;
            let totalWeight = 0;
            let itemsHTML = '';
            
            document.querySelectorAll('.product-row').forEach(row => {
                const id = row.id.split('-')[1];
                const sku = document.getElementById(`sku-${id}`).value || 'Item sin descripciÃ³n';
                const qty = parseInt(document.getElementById(`qty-${id}`).value) || 0;
                const price = parseFloat(document.getElementById(`price-${id}`).value) || 0;
                const weight = parseFloat(document.getElementById(`weight-${id}`).value) || 0;
                const lineTotal = qty * price;
                const lineWeight = qty * weight;
                
                if (qty > 0 && price > 0) {
                    fobTotal += lineTotal;
                    totalWeight += lineWeight;
                    
                    itemsHTML += `
                        <tr>
                            <td>${sku}</td>
                            <td class="text-center">${qty}</td>
                            <td class="text-right">${currencySymbol}${price.toFixed(2)}</td>
                            <td class="text-right">${lineWeight.toFixed(2)} kg</td>
                            <td class="text-right">${currencySymbol}${lineTotal.toFixed(2)}</td>
                        </tr>
                    `;
                }
            });
            
            if (!itemsHTML) {
                itemsHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">Sin items</td></tr>';
            }
            
            const volume = parseFloat(document.getElementById('totalVolume').value) || 0;
            const shipping = parseFloat(document.getElementById('shippingCost').value) || 0;
            const insuranceRate = parseFloat(document.getElementById('insuranceRate').value) || 0;
            const handling = parseFloat(document.getElementById('handlingCost').value) || 0;
            const customsRate = parseFloat(document.getElementById('customsDuty').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const broker = parseFloat(document.getElementById('brokerFee').value) || 0;
            
            const insurance = fobTotal * (insuranceRate / 100);
            const cifValue = fobTotal + shipping + insurance;
            const customsDuty = cifValue * (customsRate / 100);
            const taxableBase = cifValue + customsDuty;
            const tax = taxableBase * (taxRate / 100);
            const totalLanded = taxableBase + tax + handling + broker;
            
            const cargoLabel = cargoType === 'FCL' ? 'FCL (Full Container)' : cargoType === 'LCL' ? 'LCL (Consolidated)' : 'Air Freight';
            
            return `
                <div class="pdf-header">
                    <div class="pdf-company">INDUSTRIAS TOBIAS</div>
                    <div class="pdf-family">A Family Company</div>
                    <div class="pdf-type">Proforma Invoice</div>
                </div>
                
                <div class="pdf-trade">
                    <div class="pdf-trade-box">
                        <div class="pdf-trade-label">PaÃ­s de Origen</div>
                        <div class="pdf-trade-value">${countryFlags[originCode]} ${countryNames[originCode]}</div>
                    </div>
                    <div class="pdf-arrow">â†’</div>
                    <div class="pdf-trade-box">
                        <div class="pdf-trade-label">PaÃ­s de Destino</div>
                        <div class="pdf-trade-value">${countryFlags[destCode]} ${countryNames[destCode]}</div>
                    </div>
                </div>
                
                <div class="pdf-grid">
                    <div>
                        <div class="pdf-block">
                            <div class="pdf-label">Exportador / Shipper</div>
                            <div class="pdf-value">
                                <strong>INDUSTRIAS TOBIAS S.A.</strong><br>
                                350 Fifth Avenue, Suite 2500<br>
                                New York, NY 10118, USA<br>
                                industriastobias@gmail.com<br>
                                +1 (212) 555-0147
                            </div>
                        </div>
                        <div class="pdf-block">
                            <div class="pdf-label">Importador / Consignee</div>
                            <div class="pdf-value">${clientName}<br>${taxId}</div>
                        </div>
                    </div>
                    <div>
                        <div class="pdf-block">
                            <div class="pdf-label">NÂ° Proforma / Reference</div>
                            <div class="pdf-value">${proformaNum}</div>
                        </div>
                        <div class="pdf-block">
                            <div class="pdf-label">Fecha / Date</div>
                            <div class="pdf-value">${dateStr}</div>
                        </div>
                        <div class="pdf-block">
                            <div class="pdf-label">Ruta / Route</div>
                            <div class="pdf-value">${originPort.options[originPort.selectedIndex].text.split(',')[0]} â†’ ${destPort.options[destPort.selectedIndex].text.split(',')[0]}</div>
                        </div>
                        <div class="pdf-block">
                            <div class="pdf-label">Incoterm</div>
                            <div class="pdf-value">${incoterm}</div>
                        </div>
                        <div class="pdf-block">
                            <div class="pdf-label">CategorÃ­a</div>
                            <div class="pdf-value">${category}</div>
                        </div>
                        <div class="pdf-block">
                            <div class="pdf-label">Pago / Payment</div>
                            <div class="pdf-value">${payment}</div>
                        </div>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Item / Description</th>
                            <th class="text-center">Qty</th>
                            <th class="text-right">Unit Price</th>
                            <th class="text-right">Weight</th>
                            <th class="text-right">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itemsHTML}
                    </tbody>
                </table>
                
                <div class="pdf-costs">
                    <div class="pdf-costs-title">Desglose de Costos LogÃ­sticos / Logistics Breakdown</div>
                    <div class="pdf-costs-grid">
                        <div class="pdf-cost-item"><span>Total Weight:</span><span>${totalWeight.toFixed(2)} kg</span></div>
                        <div class="pdf-cost-item"><span>Volume:</span><span>${volume.toFixed(2)} CBM</span></div>
                        <div class="pdf-cost-item"><span>Cargo Type:</span><span>${cargoLabel}</span></div>
                        <div class="pdf-cost-item"><span>Freight:</span><span>${currencySymbol}${shipping.toFixed(2)}</span></div>
                        <div class="pdf-cost-item"><span>Insurance (${insuranceRate}%):</span><span>${currencySymbol}${insurance.toFixed(2)}</span></div>
                        <div class="pdf-cost-item"><span>Handling:</span><span>${currencySymbol}${handling.toFixed(2)}</span></div>
                        <div class="pdf-cost-item"><span>Customs Duty (${customsRate}%):</span><span>${currencySymbol}${customsDuty.toFixed(2)}</span></div>
                        <div class="pdf-cost-item"><span>Broker:</span><span>${currencySymbol}${broker.toFixed(2)}</span></div>
                        <div class="pdf-cost-item"><span>Tax (${taxRate}%):</span><span>${currencySymbol}${tax.toFixed(2)}</span></div>
                    </div>
                </div>
                
                <div class="pdf-totals">
                    <div class="pdf-total-row"><span>FOB Total:</span><span>${currencySymbol}${fobTotal.toFixed(2)}</span></div>
                    <div class="pdf-total-row"><span>Shipping (CIF):</span><span>${currencySymbol}${(shipping + insurance).toFixed(2)}</span></div>
                    <div class="pdf-total-row"><span>Taxable Base:</span><span>${currencySymbol}${taxableBase.toFixed(2)}</span></div>
                    <div class="pdf-total-row"><span>Total Taxes & Duties:</span><span>${currencySymbol}${(customsDuty + tax).toFixed(2)}</span></div>
                    <div class="pdf-total-row pdf-total-final"><span>TOTAL LANDED COST:</span><span>${currencySymbol}${totalLanded.toFixed(2)}</span></div>
                </div>
                
                <div style="margin-top: 15px; font-size: 10px; color: #8C8B87;">
                    <strong>Lead Time:</strong> ${leadTime}
                </div>
                
                <div class="pdf-footer">
                    <p style="font-style: italic; margin-bottom: 10px;">
                        "All prices are subject to currency fluctuation. Validity: 30 calendar days.<br>
                        Los precios estÃ¡n sujetos a fluctuaciÃ³n de tipo de cambio. Validez: 30 dÃ­as calendario."
                    </p>
                    <p>
                        <strong>Industrias Tobias S.A.</strong> | Registered in New York, USA<br>
                        350 Fifth Avenue, Suite 2500, New York, NY 10118<br>
                        industriastobias@gmail.com | +1 (212) 555-0147
                    </p>
                </div>
                
                <div class="pdf-stamp">${fobTotal > 0 ? 'VALIDADO' : 'PENDIENTE'}</div>
            `;
        }

        function downloadPDF() {
            document.getElementById('loading').classList.add('active');
            
            // Generar contenido limpio para PDF
            const pdfElement = document.getElementById('pdfElement');
            pdfElement.innerHTML = generatePDFContent();
            
            const client = document.getElementById('clientName').value || 'Cliente';
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `Proforma_IndustriasTobias_${client.replace(/\s+/g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true, 
                    backgroundColor: '#ffffff',
                    logging: false,
                    windowWidth: 800
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait'
                }
            };
            
            html2pdf().set(opt).from(pdfElement).save().then(() => {
                document.getElementById('loading').classList.remove('active');
                pdfElement.innerHTML = ''; // Limpiar despuÃ©s
            }).catch(err => {
                console.error('Error PDF:', err);
                document.getElementById('loading').classList.remove('active');
                pdfElement.innerHTML = '';
                alert('Error al generar PDF. Intente nuevamente.');
            });
        }

        function resetForm() {
            if (confirm('Â¿Limpiar todos los datos? Esta acciÃ³n no se puede deshacer.')) {
                localStorage.removeItem('tobiasProformaData');
                
                document.querySelectorAll('input').forEach(i => {
                    if (i.type !== 'button') i.value = '';
                });
                document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
                document.querySelectorAll('.category-card').forEach(c => c.classList.remove('active'));
                selectedCategory = null;
                
                document.getElementById('productsContainer').innerHTML = '';
                productCount = 0;
                addProduct();
                
                document.getElementById('insuranceRate').value = 2;
                document.getElementById('taxRate').value = 13;
                document.getElementById('originCountry').value = 'SV';
                document.getElementById('destinationCountry').value = 'US';
                
                updatePreview();
                updateCalculations();
            }
        }

        window.addEventListener('beforeunload', () => {
            saveData();
        });
    </script>
</body>
</html>
