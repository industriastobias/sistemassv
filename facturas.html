<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Facturas - KLOHESV & CASEUP</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: "Courier New", monospace;
      background-color: #f9f9f9;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .ticket {
      width: 320px;
      background: #fff;
      padding: 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      border-radius: 8px;
      margin-bottom: 40px;
    }
    h2 {
      text-align: center;
      margin-bottom: 5px;
      letter-spacing: 1px;
    }
    .center {
      text-align: center;
    }
    .info, .footer {
      font-size: 13px;
      margin-top: 10px;
      border-top: 1px dashed #999;
      padding-top: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 10px;
    }
    th, td {
      text-align: left;
      padding: 5px 0;
    }
    th {
      border-bottom: 1px dashed #999;
    }
    .total {
      border-top: 1px dashed #999;
      text-align: right;
      font-weight: bold;
      margin-top: 10px;
      padding-top: 5px;
    }
    button {
      margin-top: 10px;
      width: 100%;
      background: black;
      color: white;
      border: none;
      padding: 8px;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background: #333;
    }
    .social {
      font-size: 12px;
      margin-top: 5px;
      text-align: center;
      color: #555;
    }
    .policy {
      font-size: 11px;
      margin-top: 8px;
      color: #444;
      text-align: center;
    }
    input[type="number"] {
      width: 60px;
      padding: 4px;
      margin-left: 5px;
    }
  </style>
</head>
<body>

<!-- FACTURA KLOHE -->
<div class="ticket" id="invoice-klohe">
  <h2>KLOHESV</h2>
  <div class="center">
    <p>San Salvador, El Salvador</p>
    <p>Correo: industriastobias@gmail.com</p>
  </div>
  <div class="social">
    <p>Instagram: @Klohesv</p>
  </div>
  <div class="info">
    <p><strong>Factura N°:</strong> <span contenteditable="true">00015</span></p>
    <p><strong>Fecha:</strong> <span class="fecha-klohe"></span></p>
    <p><strong>Cliente:</strong> <span contenteditable="true">Consumidor Final</span></p>
  </div>
  <table>
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cant</th>
        <th>Precio</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody id="productos-klohe">
      <tr>
        <td contenteditable="true">Collar</td>
        <td contenteditable="true" class="cantidad-klohe">1</td>
        <td contenteditable="true" class="precio-klohe">10.00</td>
        <td class="subtotal-klohe">10.00</td>
      </tr>
    </tbody>
  </table>
  <button onclick="agregarFila('klohe')">Agregar producto</button>
  <button onclick="calcularTotal('klohe')">Actualizar total</button>
  <div class="total">TOTAL: $<span id="total-klohe">10.00</span></div>
  <div class="footer center">
    <p>¡Gracias por su compra!</p>
    <p class="policy">No se aceptan cambios ni devoluciones, a menos que el producto esté dañado. Se aceptará dentro de los 5 días posteriores a la fecha de compra.</p>
  </div>
  <button onclick="descargarPDF('klohe')">Descargar PDF</button>
  <button onclick="imprimirFactura('klohe')">Imprimir Factura</button>
</div>

<!-- FACTURA CASEUP -->
<div class="ticket" id="invoice-caseup">
  <h2>CASEUP</h2>
  <div class="center">
    <p>San Salvador, El Salvador</p>
    <p>Correo: industriastobias@gmail.com</p>
  </div>
  <div class="social">
    <p>Instagram: <span contenteditable="true" id="ig-caseup">@caseupsv</span></p>
  </div>
  <div class="info">
    <p><strong>Factura N°:</strong> <span contenteditable="true">00016</span></p>
    <p><strong>Fecha:</strong> <span class="fecha-caseup"></span></p>
    <p><strong>Cliente:</strong> <span contenteditable="true">Consumidor Final</span></p>
  </div>
  <table>
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cant</th>
        <th>Precio</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody id="productos-caseup">
      <tr>
        <td contenteditable="true">Pulsera</td>
        <td contenteditable="true" class="cantidad-caseup">1</td>
        <td contenteditable="true" class="precio-caseup">5.00</td>
        <td class="subtotal-caseup">5.00</td>
      </tr>
    </tbody>
  </table>
  <button onclick="agregarFila('caseup')">Agregar producto</button>
  <button onclick="calcularTotal('caseup')">Actualizar total</button>
  <div style="margin-top: 10px;">
    <label>Descuento (%): </label>
    <input type="number" id="descuento-caseup" value="0" min="0" max="100" oninput="calcularTotal('caseup')">
  </div>
  <div class="total">TOTAL: $<span id="total-caseup">5.00</span></div>
  <div class="footer center">
    <p>¡Gracias por su compra!</p>
    <p class="policy">No se aceptan cambios ni devoluciones, a menos que el producto esté dañado. Se aceptará dentro de los 5 días posteriores a la fecha de compra.</p>
  </div>
  <button onclick="descargarPDF('caseup')">Descargar PDF</button>
  <button onclick="imprimirFactura('caseup')">Imprimir Factura</button>
</div>

<script>
  function obtenerFechaActual() {
    const fecha = new Date();
    const dia = String(fecha.getDate()).padStart(2, '0');
    const mes = String(fecha.getMonth() + 1).padStart(2, '0');
    const año = fecha.getFullYear();
    return `${dia}/${mes}/${año}`;
  }

  document.querySelectorAll(".fecha-klohe").forEach(el => el.innerText = obtenerFechaActual());
  document.querySelectorAll(".fecha-caseup").forEach(el => el.innerText = obtenerFechaActual());

  function agregarFila(marca) {
    const tbody = document.getElementById(`productos-${marca}`);
    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td contenteditable="true">Nuevo producto</td>
      <td contenteditable="true" class="cantidad-${marca}">1</td>
      <td contenteditable="true" class="precio-${marca}">0.00</td>
      <td class="subtotal-${marca}">0.00</td>
    `;
    tbody.appendChild(fila);
  }

  function calcularTotal(marca) {
    const suffix = marca;
    let total = 0;
    const filas = document.querySelectorAll(`#productos-${suffix} tr`);
    filas.forEach(fila => {
      const cantidad = parseFloat(fila.querySelector(`.cantidad-${suffix}`).innerText) || 0;
      const precio = parseFloat(fila.querySelector(`.precio-${suffix}`).innerText) || 0;
      const subtotal = cantidad * precio;
      fila.querySelector(`.subtotal-${suffix}`).innerText = subtotal.toFixed(2);
      total += subtotal;
    });

    if (marca === 'caseup') {
      const descuento = parseFloat(document.getElementById('descuento-caseup').value) || 0;
      total = total - (total * descuento / 100);
    }

    document.getElementById(`total-${suffix}`).innerText = total.toFixed(2);
  }

  function descargarPDF(marca) {
    const id = `invoice-${marca}`;
    const invoice = document.getElementById(id);
    const botones = invoice.querySelectorAll("button");
    botones.forEach(btn => btn.style.display = "none");

    html2canvas(invoice).then(canvas => {
      const imgData = canvas.toDataURL("image/png");
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("p", "mm", [140, 200]);
      const imgWidth = 130;
      const imgHeight = (canvas.height * imgWidth) / canvas.width;
      pdf.addImage(imgData, "PNG", 5, 5, imgWidth, imgHeight);
      pdf.save(`factura_${marca.toUpperCase()}.pdf`);
      botones.forEach(btn => btn.style.display = "block");
    });
  }

  function imprimirFactura(marca) {
    const id = `invoice-${marca}`;
    const invoice = document.getElementById(id);
    const botones = invoice.querySelectorAll("button");
    botones.forEach(btn => btn.style.display = "none");
    window.print();
    botones.forEach(btn => btn.style.display = "block");
  }

  // Inicializar totales
  calcularTotal('klohe');
  calcularTotal('caseup');
</script>

</body>
</html>
