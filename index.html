<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOGIN - IndexedDB</title>
  <style>
    body{font-family:'Arial',sans-serif;background:#f0f0f0;display:flex;height:100vh;justify-content:center;align-items:center;margin:0;position:relative;overflow:hidden}
    .container{display:none;background:rgba(255,255,255,.9);padding:2em 1em;border-radius:20px;box-shadow:0 8px 25px rgba(0,0,0,.2);width:90%;max-width:300px;text-align:center;position:relative;z-index:10;animation:fadeIn .5s ease-in-out}
    @keyframes fadeIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    .header{text-align:center;margin-bottom:1em}
    h1{color:#4a6a41;font-size:2.5em;margin:0}
    h3{color:#2c3e50;font-size:1.5em;margin:0 0 1em}
    input{width:calc(100% - 20px);padding:10px;margin-bottom:1em;border:2px solid #4a6a41;border-radius:10px;font-size:1em;transition:border-color .3s}
    input:focus{border-color:#00796b;outline:none}
    .button{background-color:#4a6a41;color:#fff;border:none;padding:10px;border-radius:10px;cursor:pointer;width:100%;font-size:1.1em;transition:background-color .3s,transform .2s}
    .button:hover{background-color:#3b5e38;transform:scale(1.05)}
    .logo{max-width:80px;margin-bottom:.5em;margin-top:-30px}
  </style>
</head>
<body>

<div class="header">
  <h1>INDUSTRIAS TOBÍAS</h1>
  <h3>A FAMILY COMPANY</h3>
</div>
<img src="logo.jpg" alt="Logo de Industrias Tobias" class="logo">

<div class="container">
  <h2>Welcome</h2>
  <input type="text" id="userID" placeholder="ID de Usuario" required autofocus>
  <input type="password" id="userClave" placeholder="Contraseña" required>
  <button class="button" onclick="login()">login</button>
</div>

<script>
const DB_NAME = 'sessionDB', STORE_NAME = 'sessions';
let db;
async function openDB() {
  return new Promise((res, rej) => {
    const req = indexedDB.open(DB_NAME, 1);
    req.onerror = () => rej(req.error);
    req.onsuccess = () => res(db = req.result);
    req.onupgradeneeded = () => {
      const db = req.result;
      if (!db.objectStoreNames.contains(STORE_NAME))
        db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
    };
  });
}

async function guardarSesion(session) {
  const tx = db.transaction([STORE_NAME], 'readwrite');
  tx.objectStore(STORE_NAME).add(session);
}

/* ---------- Usuarios ---------- */
const users = [
  { id: '2005', clave: 'admin2024', nombre: 'ERNESTO TOBIAS', foto: 'user2005.jpg' },
  { id: '1001', clave: 'viewer2024', nombre: 'PAOLA PALACIOS', foto: 'userpaola.jpg' }
];

/* ---------- Login ---------- */
async function login() {
  const userID = document.getElementById('userID').value.trim();
  const userClave = document.getElementById('userClave').value.trim();
  const user = users.find(u => u.id === userID && u.clave === userClave);
  if (!user) { alert('ID o contraseña incorrectos.'); return; }

  await guardarSesion({ id: user.id, time: new Date().toLocaleString() });
  sessionStorage.setItem('loggedIn', 'true');
  sessionStorage.setItem('userID', user.id);
  sessionStorage.setItem('userNombre', user.nombre);
  sessionStorage.setItem('userFoto', user.foto);

  setTimeout(() => location.href = 'menu.html', 1000);
}

window.addEventListener('DOMContentLoaded', async () => {
  await openDB();
  document.querySelector('.container').style.display = 'block';
});

document.addEventListener('keypress', e => {
  if (e.key === 'Enter') {
    const active = document.activeElement;
    if (active.id === 'userID') document.getElementById('userClave').focus();
    else if (active.id === 'userClave') login();
  }
});
</script>
</body>
</html>
